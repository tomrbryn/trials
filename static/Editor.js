"use strict";var Main=(()=>{var _t=Object.defineProperty;var En=Object.getOwnPropertyDescriptor;var Bn=Object.getOwnPropertyNames;var kn=Object.prototype.hasOwnProperty;var Ln=(t,e)=>{for(var n in e)_t(t,n,{get:e[n],enumerable:!0})},Sn=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Bn(e))!kn.call(t,i)&&i!==n&&_t(t,i,{get:()=>e[i],enumerable:!(r=En(e,i))||r.enumerable});return t};var Nn=t=>Sn(_t({},"__esModule",{value:!0}),t);var ar={};Ln(ar,{Editor:()=>xt});function M(){}function yt(t){return t()}function Xe(){return Object.create(null)}function Y(t){t.forEach(yt)}function $e(t){return typeof t=="function"}function re(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function jt(t){return Object.keys(t).length===0}function zt(t,...e){if(t==null){for(let r of e)r(void 0);return M}let n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function pe(t,e,n){t.$$.on_destroy.push(zt(e,n))}function me(t,e,n){return t.set(n),e}var Ft=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;var qe=class t{_listeners="WeakMap"in Ft?new WeakMap:void 0;_observer=void 0;options;constructor(e){this.options=e}observe(e,n){return this._listeners.set(e,n),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){return this._observer??(this._observer=new ResizeObserver(e=>{for(let n of e)t.entries.set(n.target,n),this._listeners.get(n.target)?.(n)}))}};qe.entries="WeakMap"in Ft?new WeakMap:void 0;var Wt=!1;function Ht(){Wt=!0}function Yt(){Wt=!1}function p(t,e){t.appendChild(e)}function H(t,e,n){t.insertBefore(e,n||null)}function O(t){t.parentNode&&t.parentNode.removeChild(t)}function Ze(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function y(t){return document.createElement(t)}function de(t){return document.createTextNode(t)}function E(){return de(" ")}function R(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function oe(t){return function(e){return e.preventDefault(),t.call(this,e)}}function le(t){return function(e){return e.stopPropagation(),t.call(this,e)}}function v(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function Ke(t){return t===""?null:+t}function Jt(t){return Array.from(t.childNodes)}function Ce(t,e){e=""+e,t.data!==e&&(t.data=e)}function ve(t,e){t.value=e??""}function S(t,e,n,r){n==null?t.style.removeProperty(e):t.style.setProperty(e,n,r?"important":"")}function K(t,e,n){t.classList.toggle(e,!!n)}function et(t,e,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(t,{detail:e,bubbles:n,cancelable:r})}function Gt(t){let e={};return t.childNodes.forEach(n=>{e[n.slot||"default"]=!0}),e}var we;function ge(t){we=t}function vt(){if(!we)throw new Error("Function called outside component initialization");return we}function wt(t){vt().$$.on_mount.push(t)}function be(){let t=vt();return(e,n,{cancelable:r=!1}={})=>{let i=t.$$.callbacks[e];if(i){let s=et(e,n,{cancelable:r});return i.slice().forEach(o=>{o.call(t,s)}),!s.defaultPrevented}return!0}}var Qe=[];var te=[],Ne=[],Xt=[],Tn=Promise.resolve(),Ut=!1;function qt(){Ut||(Ut=!0,Tn.then(tt))}function Re(t){Ne.push(t)}var Qt=new Set,Se=0;function tt(){if(Se!==0)return;let t=we;do{try{for(;Se<Qe.length;){let e=Qe[Se];Se++,ge(e),Pn(e.$$)}}catch(e){throw Qe.length=0,Se=0,e}for(ge(null),Qe.length=0,Se=0;te.length;)te.pop()();for(let e=0;e<Ne.length;e+=1){let n=Ne[e];Qt.has(n)||(Qt.add(n),n())}Ne.length=0}while(Qe.length);for(;Xt.length;)Xt.pop()();Ut=!1,Qt.clear(),ge(t)}function Pn(t){if(t.fragment!==null){t.update(),Y(t.before_update);let e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Re)}}function Zt(t){let e=[],n=[];Ne.forEach(r=>t.indexOf(r)===-1?e.push(r):n.push(r)),n.forEach(r=>r()),Ne=e}var nt=new Set,Ue;function rt(){Ue={r:0,c:[],p:Ue}}function it(){Ue.r||Y(Ue.c),Ue=Ue.p}function Z(t,e){t&&t.i&&(nt.delete(t),t.i(e))}function ie(t,e,n,r){if(t&&t.o){if(nt.has(t))return;nt.add(t),Ue.c.push(()=>{nt.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}else r&&r()}function ae(t){return t?.length!==void 0?t:Array.from(t)}function Kt(t,e){t.d(1),e.delete(t.key)}function en(t,e,n,r,i,s,o,c,d,l,u,g){let f=t.length,m=s.length,h=f,b={};for(;h--;)b[t[h].key]=h;let F=[],B=new Map,T=new Map,U=[];for(h=m;h--;){let w=g(i,s,h),A=n(w),N=o.get(A);N?r&&U.push(()=>N.p(w,e)):(N=l(A,w),N.c()),B.set(A,F[h]=N),A in b&&T.set(A,Math.abs(h-b[A]))}let L=new Set,k=new Set;function I(w){Z(w,1),w.m(c,u),o.set(w.key,w),u=w.first,m--}for(;f&&m;){let w=F[m-1],A=t[f-1],N=w.key,D=A.key;w===A?(u=w.first,f--,m--):B.has(D)?!o.has(N)||L.has(N)?I(w):k.has(D)?f--:T.get(N)>T.get(D)?(k.add(N),I(w)):(L.add(D),f--):(d(A,o),f--)}for(;f--;){let w=t[f];B.has(w.key)||d(w,o)}for(;m;)I(F[m-1]);return Y(U),F}var Mn=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],On=new Set([...Mn]);function Ie(t){t&&t.c()}function Ee(t,e,n){let{fragment:r,after_update:i}=t.$$;r&&r.m(e,n),Re(()=>{let s=t.$$.on_mount.map(yt).filter($e);t.$$.on_destroy?t.$$.on_destroy.push(...s):Y(s),t.$$.on_mount=[]}),i.forEach(Re)}function Be(t,e){let n=t.$$;n.fragment!==null&&(Zt(n.after_update),Y(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function zn(t,e){t.$$.dirty[0]===-1&&(Qe.push(t),qt(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function fe(t,e,n,r,i,s,o=null,c=[-1]){let d=we;ge(t);let l=t.$$={fragment:null,ctx:[],props:s,update:M,not_equal:i,bound:Xe(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(d?d.$$.context:[])),callbacks:Xe(),dirty:c,skip_bound:!1,root:e.target||d.$$.root};o&&o(l.root);let u=!1;if(l.ctx=n?n(t,e.props||{},(g,f,...m)=>{let h=m.length?m[0]:f;return l.ctx&&i(l.ctx[g],l.ctx[g]=h)&&(!l.skip_bound&&l.bound[g]&&l.bound[g](h),u&&zn(t,g)),f}):[],l.update(),u=!0,Y(l.before_update),l.fragment=r?r(l.ctx):!1,e.target){if(e.hydrate){Ht();let g=Jt(e.target);l.fragment&&l.fragment.l(g),g.forEach(O)}else l.fragment&&l.fragment.c();e.intro&&Z(t.$$.fragment),Ee(t,e.target,e.anchor),Yt(),tt()}ge(d)}var Wn;typeof HTMLElement=="function"&&(Wn=class extends HTMLElement{$$ctor;$$s;$$c;$$cn=!1;$$d={};$$r=!1;$$p_d={};$$l={};$$l_u=new Map;constructor(t,e,n){super(),this.$$ctor=t,this.$$s=e,n&&this.attachShadow({mode:"open"})}addEventListener(t,e,n){if(this.$$l[t]=this.$$l[t]||[],this.$$l[t].push(e),this.$$c){let r=this.$$c.$on(t,e);this.$$l_u.set(e,r)}super.addEventListener(t,e,n)}removeEventListener(t,e,n){if(super.removeEventListener(t,e,n),this.$$c){let r=this.$$l_u.get(e);r&&(r(),this.$$l_u.delete(e))}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let t=function(i){return()=>{let s;return{c:function(){s=y("slot"),i!=="default"&&v(s,"name",i)},m:function(d,l){H(d,s,l)},d:function(d){d&&O(s)}}}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;let e={},n=Gt(this);for(let i of this.$$s)i in n&&(e[i]=[t(i)]);for(let i of this.attributes){let s=this.$$g_p(i.name);s in this.$$d||(this.$$d[s]=Et(s,i.value,this.$$p_d,"toProp"))}for(let i in this.$$p_d)!(i in this.$$d)&&this[i]!==void 0&&(this.$$d[i]=this[i],delete this[i]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:e,$$scope:{ctx:[]}}});let r=()=>{this.$$r=!0;for(let i in this.$$p_d)if(this.$$d[i]=this.$$c.$$.ctx[this.$$c.$$.props[i]],this.$$p_d[i].reflect){let s=Et(i,this.$$d[i],this.$$p_d,"toAttribute");s==null?this.removeAttribute(this.$$p_d[i].attribute||i):this.setAttribute(this.$$p_d[i].attribute||i,s)}this.$$r=!1};this.$$c.$$.after_update.push(r),r();for(let i in this.$$l)for(let s of this.$$l[i]){let o=this.$$c.$on(i,s);this.$$l_u.set(s,o)}this.$$l={}}}attributeChangedCallback(t,e,n){this.$$r||(t=this.$$g_p(t),this.$$d[t]=Et(t,n,this.$$p_d,"toProp"),this.$$c?.$set({[t]:this.$$d[t]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{!this.$$cn&&this.$$c&&(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(t){return Object.keys(this.$$p_d).find(e=>this.$$p_d[e].attribute===t||!this.$$p_d[e].attribute&&e.toLowerCase()===t)||t}});function Et(t,e,n,r){let i=n[t]?.type;if(e=i==="Boolean"&&typeof e!="boolean"?e!=null:e,!r||!n[t])return e;if(r==="toAttribute")switch(i){case"Object":case"Array":return e==null?null:JSON.stringify(e);case"Boolean":return e?"":null;case"Number":return e??null;default:return e}else switch(i){case"Object":case"Array":return e&&JSON.parse(e);case"Boolean":return e;case"Number":return e!=null?+e:e;default:return e}}var ne=class{$$=void 0;$$set=void 0;$destroy(){Be(this,1),this.$destroy=M}$on(e,n){if(!$e(n))return M;let r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{let i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(e){this.$$set&&!jt(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};var tn="4";var Ve=[];function Ae(t,e=M){let n,r=new Set;function i(c){if(re(t,c)&&(t=c,n)){let d=!Ve.length;for(let l of r)l[1](),Ve.push(l,t);if(d){for(let l=0;l<Ve.length;l+=2)Ve[l][0](Ve[l+1]);Ve.length=0}}}function s(c){i(c(t))}function o(c,d=M){let l=[c,d];return r.add(l),r.size===1&&(n=e(i,s)||M),c(t),()=>{r.delete(l),r.size===0&&n&&(n(),n=null)}}return{set:i,update:s,subscribe:o}}function st(){return{id:-1,info:{name:"New Level"},json:{lineArrays:[[[-1100,0],[1100,0]]],checkpoints:[[-1e3,0],[1e3,0]],circles:[],offset:[0,0]},base64:""}}var ce=Ae(st());function Hn(t,e,n){let{subscribe:r,set:i,update:s}=Ae(t),o=c=>parseFloat(Math.min(n,Math.max(e,c)).toFixed(3));return{subscribe:r,set:c=>i(o(c)),update:c=>s(d=>o(c(d)))}}var Te=128,ke=Ae(Te),xe=Hn(.25,.05,10),Pe=["addLineArray","addCircle","addCheckpoint","movePoint"],_e=Ae("addLineArray");var j=class t{static fillOval(e,n,r,i,s=null){s&&(e.fillStyle=s),e.beginPath(),e.arc(n,r,i,0,2*Math.PI),e.fill()}static strokeOval(e,n,r,i,s=null){s&&(e.strokeStyle=s),e.beginPath(),e.arc(n,r,i,0,2*Math.PI),e.stroke()}static drawLine(e,n,r,i,s,o=null){o&&(e.strokeStyle=o),e.beginPath(),e.moveTo(n,r),e.lineTo(i,s),e.stroke()}static getContext(e){return e.width<=0||e.height<=0?null:e.getContext("2d")}static updateCanvasSize(e){return(e.width!=e.clientWidth||e.height!=e.clientHeight)&&(e.width=e.clientWidth,e.height=e.clientHeight),t.getContext(e)}};var Oe={Vertex:{x:"i64",y:"i64",prevX:"i64",prevY:"i64",accX:"i64",accY:"i64",radius:"i64",mass:"i64",collidable:"u32",type:"u32"},Edge:{length:"i64",stiffness:"i64",damping:"i64",minLength:"i64",maxLength:"i64",totalMass:"i64",visible:"u32",v1Idx:"u32",v2Idx:"u32"},Rider:{frontWheelIdx:"u32",backWheelIdx:"u32",bikeFootIdx:"u32",chainIdx:"u32",stearingIdx:"u32",buttIdx:"u32",vertices:"VertexArray",edges:"EdgeArray",startVertices:"VertexArray",startEdges:"EdgeArray",leanForwardsEdgeLengths:"i64Array",leanBackwardsEdgeLengths:"i64Array",riderEdgesIndex:"u32",riderEdgesCount:"u32"},Line:{x1:"i64",y1:"i64",x2:"i64",y2:"i64"},Circle:{x:"i64",y:"i64",radius:"i64"},Checkpoint:{x:"i64",y:"i64",passed:"u32"},Level:{lines:"LineArray",circles:"CircleArray",checkpoints:"CheckpointArray"},TrialsGame:{state:"u32",tries:"u32",currentCheckpoint:"u32",tickIdx:"u32"}};function je(t){let e={u32:{name:"u32",fields:{},size:4,isPrimitive:!0},i64:{name:"i64",fields:{},size:8,isPrimitive:!0},bool:{name:"bool",fields:{},size:4,isPrimitive:!0}},n=Object.keys(t).filter(o=>!["u32","i64","bool"].includes(o)),r=[],i=[];for(let o in t){let c=t[o],d={};for(let l in c){let u=c[l];d[l]={name:l,type:null,typeName:u,offset:0},u.endsWith("Array")&&(e[u]={name:u,fields:{},size:8,arrayType:null,arrayTypeName:u.replace("Array","")},r.push(e[u]))}e[o]={name:o,fields:d,size:null},i.push(...Object.values(d))}r.forEach(o=>{o.arrayType=e[o.arrayTypeName]}),i.forEach(o=>{o.type=e[o.typeName]});let s=o=>{if(o.size==-1)throw new Error("Cyclic type definition");if(o.size!=null)return o.size;o.size=-1;let c=0;for(let d of Object.values(o.fields))d.offset=c,d.type.name.endsWith("Array")?c+=8:c+=s(e[d.type.name]);return o.size=c,c};for(let o of Object.values(e))s(o);return e}var Me=class{constructor(e,n,r){this.schema=e;this.dataView=r;this.offset=0;this.BITS=8;this.schema=e,this.dataView=r,this.offset=e[n].size}setUint32(e,n,r,i){try{let s=this.schema[n].fields[r].offset;this.dataView.setUint32(e+s,i,!0)}catch{console.error("GameStruct.setUin32",n,r)}}setBigInt64(e,n,r,i){let s=this.schema[n].fields[r].offset;this.dataView.setBigInt64(e+s,i,!0)}setFp(e,n,r,i){let s=this.schema[n].fields[r].offset;this.setFpAt(e+s,i)}setFpAt(e,n){this.dataView.setBigInt64(e,BigInt(Math.round(n*(1<<this.BITS))),!0)}setArray(e,n,r,i){let s=this.schema[n].fields[r].offset;return this.dataView.setUint32(e+s,i[0],!0),this.dataView.setUint32(e+s+4,i[1],!0),i}getArrayElement(e,n,r){return e+this.schema[n].size*r}createArray(e,n){let r=this.offset;return this.offset+=this.schema[e].size*n,[r,n]}copy(e,n,r){let i=new Uint8Array(this.dataView.buffer,e,r);new Uint8Array(this.dataView.buffer,n,r).set(i)}};var ze=class{constructor(e,n=0){this.dataView=e;this.ptr=n}static{this.SIZE=72}setX(e){this.dataView.setBigInt64(this.ptr+0,e,!0)}getX(){return Number(this.dataView.getBigInt64(this.ptr+0,!0)/256n)}setY(e){this.dataView.setBigInt64(this.ptr+8,e,!0)}getY(){return Number(this.dataView.getBigInt64(this.ptr+8,!0)/256n)}setPrevX(e){this.dataView.setBigInt64(this.ptr+16,e,!0)}getPrevX(){return Number(this.dataView.getBigInt64(this.ptr+16,!0)/256n)}setPrevY(e){this.dataView.setBigInt64(this.ptr+24,e,!0)}getPrevY(){return Number(this.dataView.getBigInt64(this.ptr+24,!0)/256n)}setAccX(e){this.dataView.setBigInt64(this.ptr+32,e,!0)}getAccX(){return Number(this.dataView.getBigInt64(this.ptr+32,!0)/256n)}setAccY(e){this.dataView.setBigInt64(this.ptr+40,e,!0)}getAccY(){return Number(this.dataView.getBigInt64(this.ptr+40,!0)/256n)}setRadius(e){this.dataView.setBigInt64(this.ptr+48,e,!0)}getRadius(){return Number(this.dataView.getBigInt64(this.ptr+48,!0)/256n)}setMass(e){this.dataView.setBigInt64(this.ptr+56,e,!0)}getMass(){return Number(this.dataView.getBigInt64(this.ptr+56,!0)/256n)}setCollidable(e){this.dataView.setUint32(this.ptr+64,e,!0)}getCollidable(){return Number(this.dataView.getUint32(this.ptr+64,!0))}setType(e){this.dataView.setUint32(this.ptr+68,e,!0)}getType(){return Number(this.dataView.getUint32(this.ptr+68,!0))}},We=class{constructor(e,n=0){this.dataView=e;this.ptr=n}static{this.SIZE=60}setLength(e){this.dataView.setBigInt64(this.ptr+0,e,!0)}getLength(){return Number(this.dataView.getBigInt64(this.ptr+0,!0)/256n)}setStiffness(e){this.dataView.setBigInt64(this.ptr+8,e,!0)}getStiffness(){return Number(this.dataView.getBigInt64(this.ptr+8,!0)/256n)}setDamping(e){this.dataView.setBigInt64(this.ptr+16,e,!0)}getDamping(){return Number(this.dataView.getBigInt64(this.ptr+16,!0)/256n)}setMinLength(e){this.dataView.setBigInt64(this.ptr+24,e,!0)}getMinLength(){return Number(this.dataView.getBigInt64(this.ptr+24,!0)/256n)}setMaxLength(e){this.dataView.setBigInt64(this.ptr+32,e,!0)}getMaxLength(){return Number(this.dataView.getBigInt64(this.ptr+32,!0)/256n)}setTotalMass(e){this.dataView.setBigInt64(this.ptr+40,e,!0)}getTotalMass(){return Number(this.dataView.getBigInt64(this.ptr+40,!0)/256n)}setVisible(e){this.dataView.setUint32(this.ptr+48,e,!0)}getVisible(){return Number(this.dataView.getUint32(this.ptr+48,!0))}setV1Idx(e){this.dataView.setUint32(this.ptr+52,e,!0)}getV1Idx(){return Number(this.dataView.getUint32(this.ptr+52,!0))}setV2Idx(e){this.dataView.setUint32(this.ptr+56,e,!0)}getV2Idx(){return Number(this.dataView.getUint32(this.ptr+56,!0))}},ot=class{constructor(e,n=0){this.dataView=e;this.ptr=n}static{this.SIZE=8}getOffset(){return this.dataView.getUint32(this.ptr,!0)}getLength(){return this.dataView.getUint32(this.ptr+4,!0)}get(e){return new ze(this.dataView,this.getOffset()+e*72)}},lt=class{constructor(e,n=0){this.dataView=e;this.ptr=n}static{this.SIZE=8}getOffset(){return this.dataView.getUint32(this.ptr,!0)}getLength(){return this.dataView.getUint32(this.ptr+4,!0)}get(e){return new We(this.dataView,this.getOffset()+e*60)}},at=class{constructor(e,n=0){this.dataView=e;this.ptr=n}static{this.SIZE=8}getOffset(){return this.dataView.getUint32(this.ptr,!0)}getLength(){return this.dataView.getUint32(this.ptr+4,!0)}get(e){return new i64(this.dataView,this.getOffset()+e*8)}},He=class{constructor(e,n=0){this.dataView=e;this.ptr=n}static{this.SIZE=80}setFrontWheelIdx(e){this.dataView.setUint32(this.ptr+0,e,!0)}getFrontWheelIdx(){return Number(this.dataView.getUint32(this.ptr+0,!0))}setBackWheelIdx(e){this.dataView.setUint32(this.ptr+4,e,!0)}getBackWheelIdx(){return Number(this.dataView.getUint32(this.ptr+4,!0))}setBikeFootIdx(e){this.dataView.setUint32(this.ptr+8,e,!0)}getBikeFootIdx(){return Number(this.dataView.getUint32(this.ptr+8,!0))}setChainIdx(e){this.dataView.setUint32(this.ptr+12,e,!0)}getChainIdx(){return Number(this.dataView.getUint32(this.ptr+12,!0))}setStearingIdx(e){this.dataView.setUint32(this.ptr+16,e,!0)}getStearingIdx(){return Number(this.dataView.getUint32(this.ptr+16,!0))}setButtIdx(e){this.dataView.setUint32(this.ptr+20,e,!0)}getButtIdx(){return Number(this.dataView.getUint32(this.ptr+20,!0))}getVertices(){return new ot(this.dataView,this.ptr+24)}getEdges(){return new lt(this.dataView,this.ptr+32)}getStartVertices(){return new ot(this.dataView,this.ptr+40)}getStartEdges(){return new lt(this.dataView,this.ptr+48)}getLeanForwardsEdgeLengths(){return new at(this.dataView,this.ptr+56)}getLeanBackwardsEdgeLengths(){return new at(this.dataView,this.ptr+64)}setRiderEdgesIndex(e){this.dataView.setUint32(this.ptr+72,e,!0)}getRiderEdgesIndex(){return Number(this.dataView.getUint32(this.ptr+72,!0))}setRiderEdgesCount(e){this.dataView.setUint32(this.ptr+76,e,!0)}getRiderEdgesCount(){return Number(this.dataView.getUint32(this.ptr+76,!0))}},Bt=class{constructor(e,n=0){this.dataView=e;this.ptr=n}static{this.SIZE=32}setX1(e){this.dataView.setBigInt64(this.ptr+0,e,!0)}getX1(){return Number(this.dataView.getBigInt64(this.ptr+0,!0)/256n)}setY1(e){this.dataView.setBigInt64(this.ptr+8,e,!0)}getY1(){return Number(this.dataView.getBigInt64(this.ptr+8,!0)/256n)}setX2(e){this.dataView.setBigInt64(this.ptr+16,e,!0)}getX2(){return Number(this.dataView.getBigInt64(this.ptr+16,!0)/256n)}setY2(e){this.dataView.setBigInt64(this.ptr+24,e,!0)}getY2(){return Number(this.dataView.getBigInt64(this.ptr+24,!0)/256n)}},kt=class{constructor(e,n=0){this.dataView=e;this.ptr=n}static{this.SIZE=24}setX(e){this.dataView.setBigInt64(this.ptr+0,e,!0)}getX(){return Number(this.dataView.getBigInt64(this.ptr+0,!0)/256n)}setY(e){this.dataView.setBigInt64(this.ptr+8,e,!0)}getY(){return Number(this.dataView.getBigInt64(this.ptr+8,!0)/256n)}setRadius(e){this.dataView.setBigInt64(this.ptr+16,e,!0)}getRadius(){return Number(this.dataView.getBigInt64(this.ptr+16,!0)/256n)}},Lt=class{constructor(e,n=0){this.dataView=e;this.ptr=n}static{this.SIZE=20}setX(e){this.dataView.setBigInt64(this.ptr+0,e,!0)}getX(){return Number(this.dataView.getBigInt64(this.ptr+0,!0)/256n)}setY(e){this.dataView.setBigInt64(this.ptr+8,e,!0)}getY(){return Number(this.dataView.getBigInt64(this.ptr+8,!0)/256n)}setPassed(e){this.dataView.setUint32(this.ptr+16,e,!0)}getPassed(){return Number(this.dataView.getUint32(this.ptr+16,!0))}},St=class{constructor(e,n=0){this.dataView=e;this.ptr=n}static{this.SIZE=8}getOffset(){return this.dataView.getUint32(this.ptr,!0)}getLength(){return this.dataView.getUint32(this.ptr+4,!0)}get(e){return new Bt(this.dataView,this.getOffset()+e*32)}},Nt=class{constructor(e,n=0){this.dataView=e;this.ptr=n}static{this.SIZE=8}getOffset(){return this.dataView.getUint32(this.ptr,!0)}getLength(){return this.dataView.getUint32(this.ptr+4,!0)}get(e){return new kt(this.dataView,this.getOffset()+e*24)}},It=class{constructor(e,n=0){this.dataView=e;this.ptr=n}static{this.SIZE=8}getOffset(){return this.dataView.getUint32(this.ptr,!0)}getLength(){return this.dataView.getUint32(this.ptr+4,!0)}get(e){return new Lt(this.dataView,this.getOffset()+e*20)}},ct=class{constructor(e,n=0){this.dataView=e;this.ptr=n}static{this.SIZE=24}getLines(){return new St(this.dataView,this.ptr+0)}getCircles(){return new Nt(this.dataView,this.ptr+8)}getCheckpoints(){return new It(this.dataView,this.ptr+16)}},Ye=class{constructor(e,n=0){this.dataView=e;this.ptr=n}static{this.SIZE=16}setState(e){this.dataView.setUint32(this.ptr+0,e,!0)}getState(){return Number(this.dataView.getUint32(this.ptr+0,!0))}setTries(e){this.dataView.setUint32(this.ptr+4,e,!0)}getTries(){return Number(this.dataView.getUint32(this.ptr+4,!0))}setCurrentCheckpoint(e){this.dataView.setUint32(this.ptr+8,e,!0)}getCurrentCheckpoint(){return Number(this.dataView.getUint32(this.ptr+8,!0))}setTickIdx(e){this.dataView.setUint32(this.ptr+12,e,!0)}getTickIdx(){return Number(this.dataView.getUint32(this.ptr+12,!0))}};var rn=0,se=1,nn=2;function Yn(t){return function(){return t=(1664525*t+1013904223)%4294967296,t/4294967296}}var Je=class{constructor(){this.x=0;this.y=0}},dt=class{constructor(){this.pos=new Je;this.old=new Je;this.acc=new Je;this.radius=0;this.mass=1;this.collidable=!1;this.type=rn}update(){let e=this.pos.x,n=this.pos.y;this.pos.x+=this.pos.x-this.old.x+this.acc.x,this.pos.y+=this.pos.y-this.old.y+this.acc.y,this.old.x=e,this.old.y=n}static lineLength(e,n){let r=e.pos.x-n.pos.x,i=e.pos.y-n.pos.y;return Math.sqrt(r*r+i*i)}},Vt=class{constructor(){this.length=0;this.stiffness=0;this.damping=0;this.minLength=0;this.maxLength=0;this.totalMass=0;this.visible=!1;this.v1Idx=0;this.v2Idx=0}};function X(t,e,n,r=rn){let i=new dt;return i.pos.x=t,i.pos.y=e,i.old.x=t,i.old.y=e,i.radius=n,i.mass=Math.PI*n*n,i.collidable=!0,i.type=r,i}function ye(t,e,n,r,i){let s=new Vt;return s.stiffness=r,s.damping=i,s.v1Idx=t.indexOf(e),s.v2Idx=t.indexOf(n),s.length=dt.lineLength(e,n),s.totalMass=e.mass+n.mass,s.maxLength=1e5,s.visible=!0,s}function ut(t,e,n){let r=[];for(let i=0;i<e.length;i++)for(let s=i+1;s<e.length;s++)r.push(ye(t,e[i],e[s],n,0));return r}var ft=class{constructor(){this.vertices=[];this.edges=[];this.leanForwardsEdgeLengths=[];this.leanBackwardsEdgeLengths=[];this.riderEdgesIndex=0;this.riderEdgesCount=0;this.backWheelIdx=0;this.frontWheelIdx=0;this.bikeFootIdx=0;this.chainIdx=0;this.stearingIdx=0;this.buttIdx=0}create(){this.backWheelIdx=this.createWheel(48,125,38,8,nn),this.frontWheelIdx=this.createWheel(223,125,38,8,nn);let e=this.vertices[this.backWheelIdx],n=this.vertices[this.frontWheelIdx],r=X(176,19,10),i=X(101,114,10),s=X(125,113,13),o=X(125,33,15),c=X(144,116,11),d=X(70,59,8),l=[r,i,s,c,d,o];this.bikeFootIdx=this.vertices.length+l.indexOf(i),this.chainIdx=this.vertices.length+l.indexOf(s),this.stearingIdx=this.vertices.length+l.indexOf(r);for(let J=0;J<l.length;J++)this.vertices.push(l[J]);let u=1;this.addRandomEdges(ut(this.vertices,l,u));let g=ye(this.vertices,n,r,.15,0);g.damping=.05,g.maxLength=120,g.minLength=90,g.length=120,this.addRandom(g),this.addRandom(ye(this.vertices,n,s,u,0)),this.addRandom(ye(this.vertices,n,s,u,0)),this.addRandom(ye(this.vertices,n,s,u,0)),this.addRandom(ye(this.vertices,e,s,u,0)),this.addRandom(ye(this.vertices,e,s,u,0)),this.addRandom(ye(this.vertices,e,s,u,0));let f=ye(this.vertices,e,d,.12,0);f.maxLength=70,f.minLength=50,f.damping=.05,this.addRandom(f),this.addRandom(f);let m=X(130,80,11,se),h=X(95,50,15,se),b=X(137,15,15,se),F=X(150,-10,10,se),B=X(100,114,10,se);B.collidable=!1;let T=X(175,19,10,se),U=X(130,80,11,se),L=X(130,20,15,se),k=X(175,-20,15,se),I=X(190,-45,10,se),w=X(100,114,10,se);w.collidable=!1;let A=X(175,19,10,se),N=[m,h,b,F,B,T];this.buttIdx=this.vertices.length+N.indexOf(h);for(let J=0;J<N.length;J++)this.vertices.push(N[J]);N.push(r),N.push(i);let D=[U,L,k,I,w,A,r,i];this.leanForwardsEdgeLengths=ut(this.vertices,N,.9).map(J=>J.length);let z=ut(this.vertices,N,.9);this.leanBackwardsEdgeLengths=ut(D,D,.9).map(J=>J.length),this.riderEdgesIndex=this.edges.length,this.riderEdgesCount=z.length,this.addEdges(z)}createWheel(e,n,r,i,s){let o=X(e,n,r+i,s);return o.mass=500,o.old.x=o.pos.x,this.vertices.push(o)-1}addEdges(e){this.edges.push(...e)}addRandomEdges(e){for(let n=0;n<e.length;n++)this.addRandom(e[n])}addRandom(e){let n=Yn(123456),r=Math.floor(n()*this.edges.length);this.edges.splice(r,0,e)}applyToBuilder(e){e.setUint32(0,"Rider","riderEdgesIndex",this.riderEdgesIndex),e.setUint32(0,"Rider","riderEdgesCount",this.riderEdgesCount),e.setUint32(0,"Rider","backWheelIdx",this.backWheelIdx),e.setUint32(0,"Rider","frontWheelIdx",this.frontWheelIdx),e.setUint32(0,"Rider","bikeFootIdx",this.bikeFootIdx),e.setUint32(0,"Rider","chainIdx",this.chainIdx),e.setUint32(0,"Rider","stearingIdx",this.stearingIdx),e.setUint32(0,"Rider","buttIdx",this.buttIdx);let[n,r]=e.setArray(0,"Rider","vertices",e.createArray("Vertex",this.vertices.length));for(let h=0;h<this.vertices.length;h++){let b=e.getArrayElement(n,"Vertex",h);e.setFp(b,"Vertex","x",this.vertices[h].pos.x),e.setFp(b,"Vertex","y",this.vertices[h].pos.y),e.setFp(b,"Vertex","radius",this.vertices[h].radius),e.setFp(b,"Vertex","mass",this.vertices[h].mass),e.setUint32(b,"Vertex","collidable",this.vertices[h].collidable?1:0),e.setUint32(b,"Vertex","type",this.vertices[h].type)}let[i,s]=e.setArray(0,"Rider","startVertices",e.createArray("Vertex",this.vertices.length));e.copy(n,i,s*ze.SIZE);let[o,c]=e.setArray(0,"Rider","edges",e.createArray("Edge",this.edges.length));for(let h=0;h<this.edges.length;h++){let b=e.getArrayElement(o,"Edge",h);e.setFp(b,"Edge","length",this.edges[h].length),e.setFp(b,"Edge","stiffness",this.edges[h].stiffness),e.setFp(b,"Edge","damping",this.edges[h].damping),e.setFp(b,"Edge","minLength",this.edges[h].minLength),e.setFp(b,"Edge","maxLength",this.edges[h].maxLength),e.setFp(b,"Edge","totalMass",this.edges[h].totalMass),e.setUint32(b,"Edge","visible",this.edges[h].visible?1:0),e.setUint32(b,"Edge","v1Idx",this.edges[h].v1Idx),e.setUint32(b,"Edge","v2Idx",this.edges[h].v2Idx)}let[d,l]=e.setArray(0,"Rider","startEdges",e.createArray("Edge",this.edges.length));e.copy(o,d,c*We.SIZE);let[u,g]=e.setArray(0,"Rider","leanForwardsEdgeLengths",e.createArray("i64",this.leanForwardsEdgeLengths.length));for(let h=0;h<this.leanForwardsEdgeLengths.length;h++)e.setFpAt(u+h*8,this.leanForwardsEdgeLengths[h]);let[f,m]=e.setArray(0,"Rider","leanBackwardsEdgeLengths",e.createArray("i64",this.leanBackwardsEdgeLengths.length));for(let h=0;h<this.leanBackwardsEdgeLengths.length;h++)e.setFpAt(f+h*8,this.leanBackwardsEdgeLengths[h])}};function $t(t,e,n=Number.MAX_VALUE){let r={point:null,distance:n,type:"none",index:-1,subIndex:-1},i=(o,c,d,l,u=-1)=>{c<r.distance&&(r.distance=c,r.point=o,r.type=d,r.index=l,r.subIndex=u)},s=(o,c,d,l,u,g=-1)=>{let f=e.x-o,m=e.y-c,h=Math.sqrt(f*f+m*m)-d;i({x:o,y:c},h,l,u,g)};for(let o=0;o<t.circles.length;o++)s(t.circles[o][0],t.circles[o][1],t.circles[o][2],"circle",o);for(let o=0;o<t.lineArrays.length;o++)for(let c=0;c<t.lineArrays[o].length;c++)s(t.lineArrays[o][c][0],t.lineArrays[o][c][1],0,"lineArrayPoint",o,c);for(let o=0;o<t.checkpoints.length;o++){let c=t.checkpoints[o],d=c[0],l=c[1],u=c[0],g=c[1]-100;s(d,l,0,"checkpoint",o),s(u,g,0,"checkpoint",o);let f=u-d,m=g-l,h=((e.x-d)*f+(e.y-l)*m)/(f*f+m*m),b=d+h*f,F=l+h*m;if(h>=0&&h<=1){let B=Math.sqrt((e.x-b)*(e.x-b)+(e.y-F)*(e.y-F));i({x:b,y:F},B,"checkpoint",o)}}return r}function ht(t,e){let n=new ArrayBuffer(65536),r=new Me(t,"Level",new DataView(n));return Gn(r,e),n.slice(0,r.offset)}function sn(t){let e=new ArrayBuffer(65536),n=new Me(t,"Rider",new DataView(e)),r=new ft;return r.create(),r.applyToBuilder(n),e.slice(0,n.offset)}function pt(){let o=[{lineArrays:[[[0,490],[10,500],[770,500],[770,380],[1e3,380],[1200,340],[1400,250],[1400,500]]],checkpoints:[[200,500],[900,380],[2e3,250]],circles:[[770,475,100],[2e3,500,250]],offset:[0,0]},{lineArrays:[[[0,1e3],[300,1e3],[500,950],[700,800],[700,1e3],[1e3,1e3],[1e3,800],[1300,950],[1500,1e3],[2e3,1e3]]],checkpoints:[[100,1e3],[1700,1e3]],circles:[],offset:[2700,-200]},{lineArrays:[[[0,1e3],[300,1e3],[300,1100],[600,1e3],[600,1100],[900,1e3],[900,1100],[1200,1e3],[1200,1100],[1500,1e3],[1500,1100],[1800,1e3]]],checkpoints:[[100,1e3],[2e3,1e3]],circles:[],offset:[5e3,0]},{lineArrays:[[[0,2e3],[300,2e3],[600,1500],[1e3,1500],[1250,1e3],[1500,1e3]]],checkpoints:[[100,2e3],[1500,1e3]],circles:[],offset:[7e3,-1e3]},{lineArrays:[[[0,2e3],[300,2e3],[500,1750],[750,1800],[1e3,1750],[1250,2e3],[1500,2e3]]],checkpoints:[[100,2e3],[1500,2e3]],circles:[[750,1650,50]],offset:[8500,-1500]},{lineArrays:[[[0,2e3],[500,2e3],[700,1800],[700,1600],[600,1500]]],checkpoints:[[100,2e3],[1500,2e3]],circles:[[750,1650,50]],offset:[1e4,-1e3]}],c=[],d=[],l=[];for(let u of o){for(let g of u.lineArrays)Dt(g,u.offset);Dt(u.circles,u.offset),Dt(u.checkpoints,u.offset),c=c.concat(u.lineArrays),d=d.concat(u.circles),l=l.concat(u.checkpoints)}return{lineArrays:c,circles:d,checkpoints:l}}function Dt(t,e){for(let n=0;n<t.length;n++)t[n][0]+=e[0],t[n][1]+=e[1]}function on(t){let e=[];for(let n of t)ln(n).forEach(r=>e.push(r));return e}function ln(t){let e=[];for(let n=1;n<t.length;n++)e.push([[t[n-1][0],t[n-1][1]],[t[n][0],t[n][1]]]);return e}function Gn(t,e){let n=[];for(let l of e.lineArrays)ln(l).forEach(u=>n.push(u));let[r,i]=t.setArray(0,"Level","lines",t.createArray("Line",n.length));for(let l=0;l<n.length;l++){let u=t.getArrayElement(r,"Line",l),g=n[l][0],f=n[l][1];t.setFp(u,"Line","x1",g[0]),t.setFp(u,"Line","y1",g[1]),t.setFp(u,"Line","x2",f[0]),t.setFp(u,"Line","y2",f[1])}let[s,o]=t.setArray(0,"Level","checkpoints",t.createArray("Checkpoint",e.checkpoints.length));for(let l=0;l<e.checkpoints.length;l++){let u=t.getArrayElement(s,"Checkpoint",l);t.setFp(u,"Checkpoint","x",e.checkpoints[l][0]),t.setFp(u,"Checkpoint","y",e.checkpoints[l][1])}let[c,d]=t.setArray(0,"Level","circles",t.createArray("Circle",e.circles.length));for(let l=0;l<e.circles.length;l++){let u=t.getArrayElement(c,"Circle",l);t.setFp(u,"Circle","x",e.circles[l][0]),t.setFp(u,"Circle","y",e.circles[l][1]),t.setFp(u,"Circle","radius",e.circles[l][2])}}var De=null;function an(t){De&&De.close(),console.log("setupServerSideEvents"),De=new EventSource("/trials/events"),De.onmessage=t,De.onerror=e=>{De?.close(),setTimeout(()=>an(t),2e3)}}function cn(){console.log("setupReload"),an(t=>{console.log("setupReload",t.data),setTimeout(()=>location.reload(),t.data.endsWith(".js")?0:3e3)})}typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(tn);function un(t,e,n){let r=t.slice();return r[13]=e[n],r}function dn(t,e){let n,r,i=e[13].info.name+"",s,o,c=fn(e[13].info.created)+"",d,l,u,g,f,m,h,b,F;function B(){return e[7](e[13])}function T(){return e[8](e[13])}return{key:t,first:null,c(){n=y("div"),r=y("div"),s=de(i),o=E(),d=de(c),l=E(),u=y("div"),g=y("button"),g.textContent="\u{1F4C2}",f=E(),m=y("button"),m.textContent="\u{1F5D1}\uFE0F",h=E(),v(r,"class","level-info svelte-1t2bq3f"),v(g,"class","btn svelte-1t2bq3f"),v(m,"class","btn btn-trash svelte-1t2bq3f"),v(u,"class","level-buttons svelte-1t2bq3f"),v(n,"class","level-item svelte-1t2bq3f"),this.first=n},m(U,L){H(U,n,L),p(n,r),p(r,s),p(r,o),p(r,d),p(n,l),p(n,u),p(u,g),p(u,f),p(u,m),p(n,h),b||(F=[R(g,"click",B),R(m,"click",T)],b=!0)},p(U,L){e=U,L&1&&i!==(i=e[13].info.name+"")&&Ce(s,i),L&1&&c!==(c=fn(e[13].info.created)+"")&&Ce(d,c)},d(U){U&&O(n),b=!1,Y(F)}}}function Xn(t){let e,n,r,i,s,o,c=[],d=new Map,l,u,g,f,m,h,b,F,B,T,U=ae(t[0]),L=k=>k[13].id;for(let k=0;k<U.length;k+=1){let I=un(t,U,k),w=L(I);d.set(w,c[k]=dn(w,I))}return{c(){e=y("div"),n=y("h1"),r=de("Levels "),i=y("button"),i.textContent="\u21BB",s=E(),o=y("div");for(let k=0;k<c.length;k+=1)c[k].c();l=E(),u=y("dialog"),g=y("p"),g.textContent="Are you sure you want to delete this level?",f=E(),m=y("div"),h=y("button"),h.textContent="Yes",b=E(),F=y("button"),F.textContent="No",v(i,"class","refresh"),S(n,"margin","0"),S(n,"color","#2e7d32"),v(o,"class","levels-list svelte-1t2bq3f"),v(e,"class","levels-container svelte-1t2bq3f"),v(h,"class","btn svelte-1t2bq3f"),v(F,"class","btn btn-trash svelte-1t2bq3f"),v(m,"class","dialog-buttons svelte-1t2bq3f"),v(u,"class","svelte-1t2bq3f")},m(k,I){H(k,e,I),p(e,n),p(n,r),p(n,i),p(e,s),p(e,o);for(let w=0;w<c.length;w+=1)c[w]&&c[w].m(o,null);H(k,l,I),H(k,u,I),p(u,g),p(u,f),p(u,m),p(m,h),p(m,b),p(m,F),t[9](u),B||(T=[R(i,"click",t[2]),R(h,"click",t[5]),R(F,"click",t[6])],B=!0)},p(k,[I]){I&25&&(U=ae(k[0]),c=en(c,I,L,1,k,U,d,o,Kt,dn,null,un))},i:M,o:M,d(k){k&&(O(e),O(l),O(u));for(let I=0;I<c.length;I+=1)c[I].d();t[9](null),B=!1,Y(T)}}}function fn(t){function e(n,r){return`${n} ${r}${n===1?"":"s"} ago`}if(t){let n=new Date(t),r=(new Date().getTime()-n.getTime())/1e3/60;return r<1?"just now":r<60?e(r.toFixed(0),"minute"):r<60*24?e((r/60).toFixed(0),"hour"):n.getDate()+" "+n.toLocaleString("default",{month:"short"})+" "+n.getFullYear()}return""}function qn(t,e,n){let r;pe(t,ce,F=>n(11,r=F));let i=[],s,o=null,c=be();console.log("Open level",r);async function d(){n(0,i=await(await fetch("/trials/api/levels")).json())}d();async function l(F){let B=await(await fetch("/trials/api/levels/"+F.id)).json();console.log("Open level",F,B),me(ce,r=B,r),console.log("levelStore",r),c("close")}function u(F){o=F,s.showModal()}async function g(){o&&(console.log("Delete level",o),await fetch("/trials/api/levels/"+o.id,{method:"DELETE"}),d(),o=null),s.close()}function f(){o=null,s.close()}let m=F=>l(F),h=F=>u(F);function b(F){te[F?"unshift":"push"](()=>{s=F,n(1,s)})}return[i,s,d,l,u,g,f,m,h,b]}var Ct=class extends ne{constructor(e){super(),fe(this,e,qn,Xn,re,{})}},hn=Ct;function Zn(t){let e,n,r,i,s,o,c,d,l,u,g,f,m,h,b,F,B,T,U,L,k,I,w,A,N;return{c(){e=y("div"),n=y("h1"),n.textContent="Save",r=E(),i=y("div"),i.textContent="Name",s=E(),o=y("input"),c=E(),d=y("div"),l=y("button"),u=de("Save"),f=E(),m=y("button"),m.textContent="Save as copy",h=E(),b=y("button"),b.textContent="Cancel",F=E(),B=y("dialog"),T=y("p"),T.textContent="Are you sure you want to overwrite the level?",U=E(),L=y("div"),k=y("button"),k.textContent="Yes",I=E(),w=y("button"),w.textContent="No",S(n,"margin","0"),S(n,"color","#2e7d32"),v(o,"type","text"),S(o,"width","100%"),S(o,"padding","0.5rem"),S(o,"font-size","1.25rem"),v(l,"class","btn svelte-d5se3e"),l.disabled=g=!t[3]||t[3]<0,v(m,"class","btn svelte-d5se3e"),v(b,"class","btn svelte-d5se3e"),S(d,"display","flex"),S(d,"justify-content","flex-end"),S(d,"gap","0.5rem"),S(d,"margin-top","1rem"),v(e,"class","levels-container svelte-d5se3e"),v(k,"class","btn svelte-d5se3e"),v(w,"class","btn svelte-d5se3e"),v(L,"class","dialog-buttons svelte-d5se3e"),v(B,"class","svelte-d5se3e")},m(D,z){H(D,e,z),p(e,n),p(e,r),p(e,i),p(e,s),p(e,o),ve(o,t[0]),p(e,c),p(e,d),p(d,l),p(l,u),p(d,f),p(d,m),p(d,h),p(d,b),H(D,F,z),H(D,B,z),p(B,T),p(B,U),p(B,L),p(L,k),p(L,I),p(L,w),t[10](B),A||(N=[R(o,"input",t[6]),R(l,"click",t[7]),R(m,"click",t[5]),R(b,"click",t[8]),R(k,"click",t[4]),R(w,"click",t[9])],A=!0)},p(D,[z]){z&1&&o.value!==D[0]&&ve(o,D[0])},i:M,o:M,d(D){D&&(O(e),O(F),O(B)),t[10](null),A=!1,Y(N)}}}function Kn(t,e,n){let r;pe(t,ce,U=>n(13,r=U));var i,s;let o,c=be(),d=r,l=d.id,u=(s=(i=d.info)===null||i===void 0?void 0:i.name)!==null&&s!==void 0?s:"?";function g(){let U=Object.assign({},r.info,{name:u}),L=Object.assign({},r,{info:U}),k=je(Oe),I=ht(k,pt());return L.base64=btoa(String.fromCharCode(...new Uint8Array(I))),L}async function f(){if(l&&l>=0){let U=g();await fetch("/trials/api/levels/"+l,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(U)}),me(ce,r=U,r),c("close")}}async function m(){let U=g(),L=await(await fetch("/trials/api/levels",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(U)})).json();U.id=L.id,me(ce,r=U,r),c("close")}function h(){u=this.value,n(0,u)}let b=()=>o.showModal(),F=()=>c("close"),B=()=>o.close();function T(U){te[U?"unshift":"push"](()=>{o=U,n(1,o)})}return t.$$.update=()=>{t.$$.dirty&1&&console.log("Level",d,l,u)},[u,o,c,l,f,m,h,b,F,B,T]}var Rt=class extends ne{constructor(e){super(),fe(this,e,Kn,Zn,re,{})}},pn=Rt;function mn(t,e,n){let r=t.slice();return r[6]=e[n],r}function gn(t){let e,n,r;function i(){return t[4](t[6])}return{c(){e=y("button"),e.textContent=`${t[6]} `,v(e,"class","btn svelte-1nx0r7u"),K(e,"selected",t[0]==t[6])},m(s,o){H(s,e,o),n||(r=R(e,"click",le(oe(i))),n=!0)},p(s,o){t=s,o&3&&K(e,"selected",t[0]==t[6])},d(s){s&&O(e),n=!1,r()}}}function er(t){let e,n,r,i,s,o,c,d,l,u,g=ae(t[1]),f=[];for(let m=0;m<g.length;m+=1)f[m]=gn(mn(t,g,m));return{c(){e=y("div"),n=y("h1"),n.textContent="Grid",r=E(),i=y("input"),s=E(),o=y("input"),c=E(),d=y("div");for(let m=0;m<f.length;m+=1)f[m].c();S(n,"margin","0"),S(n,"color","#2e7d32"),v(i,"type","number"),v(i,"min","0"),v(i,"max","256"),v(i,"step","8"),v(o,"type","range"),v(o,"id","grid-slider"),v(o,"min","0"),v(o,"max","256"),v(o,"step","8"),S(d,"display","flex"),S(d,"gap","0.5rem"),v(e,"class","levels-container svelte-1nx0r7u")},m(m,h){H(m,e,h),p(e,n),p(e,r),p(e,i),ve(i,t[0]),p(e,s),p(e,o),ve(o,t[0]),p(e,c),p(e,d);for(let b=0;b<f.length;b+=1)f[b]&&f[b].m(d,null);l||(u=[R(i,"input",t[2]),R(o,"change",t[3]),R(o,"input",t[3])],l=!0)},p(m,[h]){if(h&1&&Ke(i.value)!==m[0]&&ve(i,m[0]),h&1&&ve(o,m[0]),h&3){g=ae(m[1]);let b;for(b=0;b<g.length;b+=1){let F=mn(m,g,b);f[b]?f[b].p(F,h):(f[b]=gn(F),f[b].c(),f[b].m(d,null))}for(;b<f.length;b+=1)f[b].d(1);f.length=g.length}},i:M,o:M,d(m){m&&O(e),Ze(f,m),l=!1,Y(u)}}}function tr(t,e,n){let r;pe(t,ke,l=>n(0,r=l));let i=be(),s=[0,32,64,128,256];function o(){r=Ke(this.value),ke.set(r)}function c(){r=Ke(this.value),ke.set(r)}return[r,s,o,c,l=>me(ke,r=l,r)]}var At=class extends ne{constructor(e){super(),fe(this,e,tr,er,re,{})}},bn=At;function xn(t,e,n){let r=t.slice();return r[28]=e[n],r}function _n(t){let e,n,r=(t[10][t[28]]||t[28])+"",i,s;function o(){return t[20](t[28])}return{c(){e=y("button"),n=y("div"),v(n,"class","icon svelte-1hz2svk"),v(e,"class","btn svelte-1hz2svk"),K(e,"mode_selected",t[7]==t[28])},m(c,d){H(c,e,d),p(e,n),n.innerHTML=r,i||(s=R(e,"click",le(oe(o))),i=!0)},p(c,d){t=c,d&128&&K(e,"mode_selected",t[7]==t[28])},d(c){c&&O(e),i=!1,s()}}}function yn(t){let e,n,r;return n=new hn({}),n.$on("close",t[21]),{c(){e=y("div"),Ie(n.$$.fragment),v(e,"class","btn-big-menu svelte-1hz2svk")},m(i,s){H(i,e,s),Ee(n,e,null),t[22](e),r=!0},p:M,i(i){r||(Z(n.$$.fragment,i),r=!0)},o(i){ie(n.$$.fragment,i),r=!1},d(i){i&&O(e),Be(n),t[22](null)}}}function Fn(t){let e,n,r;return n=new pn({}),n.$on("close",t[25]),{c(){e=y("div"),Ie(n.$$.fragment),v(e,"class","btn-small-menu svelte-1hz2svk")},m(i,s){H(i,e,s),Ee(n,e,null),t[26](e),r=!0},p:M,i(i){r||(Z(n.$$.fragment,i),r=!0)},o(i){ie(n.$$.fragment,i),r=!1},d(i){i&&O(e),Be(n),t[26](null)}}}function nr(t){let e,n,r,i,s,o,c,d,l,u,g,f,m,h,b,F,B,T,U,L,k,I,w,A,N,D,z,J=vn(t[8])+"",Fe,Le,a,_,Q,P,x,V,he,ue=ae(Pe),G=[];for(let $=0;$<ue.length;$+=1)G[$]=_n(xn(t,ue,$));let W=t[0]&&yn(t);Q=new bn({}),Q.$on("close",t[23]);let C=t[1]&&Fn(t);return{c(){e=y("div"),n=y("div"),r=E(),i=y("button"),i.innerHTML='<div class="icon svelte-1hz2svk">\u{1F4C4}</div>',s=E(),o=y("button"),o.innerHTML='<div class="icon svelte-1hz2svk">\u{1F4C2}</div> <div class="btn-arrow svelte-1hz2svk">\u25BA</div>',c=E(),d=y("button"),d.innerHTML='<div class="icon svelte-1hz2svk">\u{1F4BE}</div> <div class="btn-arrow svelte-1hz2svk">\u25BA</div>',l=E(),u=y("button"),u.innerHTML='<div class="icon svelte-1hz2svk">\u21BA</div>',g=E(),f=y("button"),f.innerHTML='<div class="icon svelte-1hz2svk">\u21BB</div>',m=E(),h=y("button"),h.innerHTML='<div class="icon svelte-1hz2svk">\u25B6</div>',b=E(),F=y("button"),F.innerHTML='<div class="icon svelte-1hz2svk">#</div> <div class="btn-arrow svelte-1hz2svk">\u25BA</div>',B=E(),T=y("div"),U=E(),L=y("hr"),k=E(),I=y("div"),w=E();for(let $=0;$<G.length;$+=1)G[$].c();A=E(),N=y("button"),D=y("div"),z=de("\u{1F50D}\uFE0F "),Fe=de(J),Le=E(),W&&W.c(),a=E(),_=y("div"),Ie(Q.$$.fragment),P=E(),C&&C.c(),S(n,"height","1rem"),v(i,"class","btn svelte-1hz2svk"),v(o,"class","btn svelte-1hz2svk"),K(o,"selected",t[0]),v(d,"class","btn svelte-1hz2svk"),K(d,"selected",t[1]),v(u,"class","btn svelte-1hz2svk"),v(f,"class","btn svelte-1hz2svk"),v(h,"class","btn svelte-1hz2svk"),v(F,"class","btn svelte-1hz2svk"),K(F,"selected",t[2]),S(T,"height","1rem"),S(I,"height","1rem"),v(D,"class","icon2"),S(D,"padding","0.5rem 0"),v(N,"class","btn svelte-1hz2svk"),S(N,"margin-top","auto"),S(N,"text-align","center"),v(_,"class","btn-small-menu svelte-1hz2svk"),K(_,"hidden",!t[2]),v(e,"class","toolbar svelte-1hz2svk")},m($,ee){H($,e,ee),p(e,n),p(e,r),p(e,i),p(e,s),p(e,o),p(e,c),p(e,d),p(e,l),p(e,u),p(e,g),p(e,f),p(e,m),p(e,h),p(e,b),p(e,F),t[19](F),p(e,B),p(e,T),p(e,U),p(e,L),p(e,k),p(e,I),p(e,w);for(let q=0;q<G.length;q+=1)G[q]&&G[q].m(e,null);p(e,A),p(e,N),p(N,D),p(D,z),p(D,Fe),p(e,Le),W&&W.m(e,null),p(e,a),p(e,_),Ee(Q,_,null),t[24](_),p(e,P),C&&C.m(e,null),x=!0,V||(he=[R(i,"click",le(oe(t[15]))),R(o,"mousedown",le(oe(t[11]))),R(d,"mousedown",le(oe(t[12]))),R(u,"click",le(oe(t[16]))),R(f,"click",le(oe(t[17]))),R(h,"click",le(oe(t[18]))),R(F,"mousedown",le(oe(t[13])))],V=!0)},p($,[ee]){if((!x||ee&1)&&K(o,"selected",$[0]),(!x||ee&2)&&K(d,"selected",$[1]),(!x||ee&4)&&K(F,"selected",$[2]),ee&1152){ue=ae(Pe);let q;for(q=0;q<ue.length;q+=1){let Ot=xn($,ue,q);G[q]?G[q].p(Ot,ee):(G[q]=_n(Ot),G[q].c(),G[q].m(e,A))}for(;q<G.length;q+=1)G[q].d(1);G.length=ue.length}(!x||ee&256)&&J!==(J=vn($[8])+"")&&Ce(Fe,J),$[0]?W?(W.p($,ee),ee&1&&Z(W,1)):(W=yn($),W.c(),Z(W,1),W.m(e,a)):W&&(rt(),ie(W,1,1,()=>{W=null}),it()),(!x||ee&4)&&K(_,"hidden",!$[2]),$[1]?C?(C.p($,ee),ee&2&&Z(C,1)):(C=Fn($),C.c(),Z(C,1),C.m(e,null)):C&&(rt(),ie(C,1,1,()=>{C=null}),it())},i($){x||(Z(W),Z(Q.$$.fragment,$),Z(C),x=!0)},o($){ie(W),ie(Q.$$.fragment,$),ie(C),x=!1},d($){$&&O(e),t[19](null),Ze(G,$),W&&W.d(),Be(Q),t[24](null),C&&C.d(),V=!1,Y(he)}}}function vn(t){return(t*100).toFixed(0)+"%"}function rr(t,e,n){let r,i;pe(t,_e,a=>n(7,r=a)),pe(t,xe,a=>n(8,i=a));let{editor:s}=e,o=!1,c=!1,d=!1,l,u,g,f,m=be(),h={addCheckpoint:"\u{1F6A9}",addCircle:"\u26AB",addLineArray:"\u250C\u2500\u2518",movePoint:"\u2194"},b=!0;window.addEventListener("keydown",a=>{a.key==="F1"&&(a.preventDefault(),b=!b)});async function F(){n(0,o=!o),o&&(n(1,c=!1),n(2,d=!1))}async function B(){console.log("toggleSaveMenu"),n(1,c=!c),c&&(n(0,o=!1),n(2,d=!1))}async function T(a){if(console.log("toggleGridMenu"),n(2,d=!d),d){let _=f.getBoundingClientRect(),Q=f.parentElement.getBoundingClientRect(),P=g.getBoundingClientRect();n(5,g.style.top=Math.min(_.top,Q.bottom-P.height)+"px",g),n(0,o=!1),n(1,c=!1)}}document.addEventListener("mousedown",a=>{l?.contains(a.target)||n(0,o=!1),u?.contains(a.target)||n(1,c=!1),g?.contains(a.target)||n(2,d=!1)});let U=()=>m("new"),L=()=>m("undo"),k=()=>m("redo"),I=()=>m("play");function w(a){te[a?"unshift":"push"](()=>{f=a,n(6,f)})}let A=a=>me(_e,r=a,r),N=()=>n(0,o=!1);function D(a){te[a?"unshift":"push"](()=>{l=a,n(3,l)})}let z=()=>n(2,d=!1);function J(a){te[a?"unshift":"push"](()=>{g=a,n(5,g)})}let Fe=()=>n(1,c=!1);function Le(a){te[a?"unshift":"push"](()=>{u=a,n(4,u)})}return t.$$set=a=>{"editor"in a&&n(14,s=a.editor)},[o,c,d,l,u,g,f,r,i,m,h,F,B,T,s,U,L,k,I,w,A,N,D,z,J,Fe,Le]}var Tt=class extends ne{constructor(e){super(),fe(this,e,rr,nr,re,{editor:14})}},wn=Tt;function ir(t){let e,n,r,i,s;return n=new wn({props:{editor:t[0]}}),n.$on("new",t[2]),n.$on("undo",t[3]),n.$on("redo",t[4]),{c(){e=y("div"),Ie(n.$$.fragment),r=E(),i=y("canvas"),S(i,"flex","1"),S(i,"min-width","0"),S(i,"min-height","0"),S(e,"position","absolute"),S(e,"top","0"),S(e,"left","0"),S(e,"right","0"),S(e,"bottom","0"),S(e,"display","flex")},m(o,c){H(o,e,c),Ee(n,e,null),p(e,r),p(e,i),t[5](i),s=!0},p(o,[c]){let d={};c&1&&(d.editor=o[0]),n.$set(d)},i(o){s||(Z(n.$$.fragment,o),s=!0)},o(o){ie(n.$$.fragment,o),s=!1},d(o){o&&O(e),Be(n),t[5](null)}}}function sr(t,e,n){let{editor:r}=e,i;wt(()=>r.start(i));let s=()=>r.new(),o=()=>r.undoRedoManager.undo(),c=()=>r.undoRedoManager.undo();function d(l){te[l?"unshift":"push"](()=>{i=l,n(1,i)})}return t.$$set=l=>{"editor"in l&&n(0,r=l.editor)},[r,i,s,o,c,d]}var Pt=class extends ne{constructor(e){super(),fe(this,e,sr,ir,re,{editor:0})}},Qn=Pt;var mt=class{constructor(){this.undoRedoStack=[];this.undoRedoIndex=0}addAction(e){this.undoRedoStack=this.undoRedoStack.slice(0,this.undoRedoIndex),this.undoRedoStack.push(e),this.undoRedoIndex=this.undoRedoStack.length,e.redo()}undo(){console.log("undo");let e=this.undoRedoStack[this.undoRedoIndex-1];e&&(e.undo(),this.undoRedoIndex--)}redo(){console.log("redo");let e=this.undoRedoStack[this.undoRedoIndex];e&&(e.redo(),this.undoRedoIndex++)}clear(){this.undoRedoStack=[],this.undoRedoIndex=0}};var Ge=class{constructor(){this.recording=[]}record(e){this.recording.push(e)}clear(){this.recording=[]}runnlengthEncode(){let e=[],n=this.recording[0],r=0,i=1;for(;i<this.recording.length;)this.recording[i]==n&&r<255?r++:(e.push(n),e.push(r),n=this.recording[i],r=0),i++;return e.push(n),e.push(r),e}runnlengthDecode(e){let n=[];for(let r=0;r<e.length;r+=2)for(let i=0;i<=e[r+1];i++)n.push(e[r]);return n}};function or(){let t=[1,1,1,2,1],e=new Ge;t.forEach(i=>e.record(i));let n=e.runnlengthEncode(),r=e.runnlengthDecode(n);if(console.log("InputRecording test",n,r,"==",t),t.some((i,s)=>i!==r[s])){console.error("InputRecording test failed");return}}or();async function Un(){return new Promise((t,e)=>{let n=document.createElement("script");n.src="/trials/public/physics.js",document.body.appendChild(n),n.onload=async()=>t(new Mt(await createPhysicsModule())),n.onerror=r=>e(new Error(`Failed to load script: ${r}`))})}var Mt=class{constructor(e){this.module=e;this.levelHeapPtr=0;this.riderHeapPtr=0;this.inputRecording=new Ge;let n=e._getGamePtr();this.trialsGame=new Ye(new DataView(e.HEAPU8.buffer,n,Ye.SIZE),0)}setData(e,n){console.log("setData",e.byteLength,n.byteLength),this.levelHeapPtr&&(console.log("freeing levelHeapPtr",this.levelHeapPtr),this.module._free(this.levelHeapPtr)),this.riderHeapPtr&&(console.log("freeing riderHeapPtr",this.riderHeapPtr),this.module._free(this.riderHeapPtr));let r=new Uint8Array(e);this.levelHeapPtr=this.module._malloc(r.length),this.module.HEAPU8.set(r,this.levelHeapPtr);let i=new Uint8Array(n);this.riderHeapPtr=this.module._malloc(i.length),this.module.HEAPU8.set(i,this.riderHeapPtr),this.module._setData(this.levelHeapPtr,this.riderHeapPtr),this.level=new ct(new DataView(this.module.HEAPU8.buffer,this.levelHeapPtr,r.length)),this.rider=new He(new DataView(this.module.HEAPU8.buffer,this.riderHeapPtr,i.length))}tick(e){this.inputRecording.record(e),this.module._tick(e)}newGame(){this.inputRecording.clear(),this.module._newGame()}};var gt=class t{constructor(e){this.canvas=e}paint(e,n,r){let i=j.updateCanvasSize(this.canvas);if(!i)return;i.lineWidth=6,i.lineCap="round",i.fillStyle="white",i.fillRect(0,0,this.canvas.width,this.canvas.height),i.fillStyle="black",i.font="16px 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif";let s=10;i.fillText("state: "+e.getState(),10,s+=20),i.fillText("tries: "+e.getTries(),10,s+=20),i.fillText("ticks: "+e.getTickIdx(),10,s+=20),i.fillText("checkpoint: "+e.getCurrentCheckpoint(),10,s+=20);let o=r.getVertices(),c=n.getLines(),d=n.getCircles(),l=n.getCheckpoints();i.save(),i.translate(this.canvas.width/2,this.canvas.height/2),i.scale(.25,.25);let u=o.get(r.getChainIdx());i.translate(-u.getX(),-u.getY()),t.paintRider(i,r);for(let g=0;g<c.getLength();g++){let f=c.get(g);j.drawLine(i,f.getX1(),f.getY1(),f.getX2(),f.getY2(),"black")}for(let g=0;g<d.getLength();g++){let f=d.get(g);j.fillOval(i,f.getX(),f.getY(),f.getRadius(),"blue")}for(let g=0;g<l.getLength();g++){let f=l.get(g);j.drawLine(i,f.getX(),f.getY(),f.getX(),f.getY()-100,"#777700")}i.restore()}static paintRider(e,n){this.paintVertices(e,n.getVertices()),this.paintEdges(e,n.getVertices(),n.getEdges())}static paintVertices(e,n){for(let r=0;r<n.getLength();r++){let i=n.get(r);j.fillOval(e,i.getX(),i.getY(),i.getRadius(),"green")}}static paintEdges(e,n,r){for(let i=0;i<r.getLength();i++){let s=r.get(i),o=n.get(s.getV1Idx()),c=n.get(s.getV2Idx());j.drawLine(e,o.getX(),o.getY(),c.getX(),c.getY(),"black")}}};var bt=class{constructor(e=null){this.keys={};window.addEventListener("keydown",n=>{this.keys[n.key]=!0,e&&e(n)}),window.addEventListener("keyup",n=>this.keys[n.key]=!1)}encodeGameInput(){let e=0;return(this.keys.w||this.keys.ArrowUp)&&(e|=4),(this.keys.a||this.keys.ArrowLeft)&&(e|=1),(this.keys.s||this.keys.ArrowDown)&&(e|=8),(this.keys.d||this.keys.ArrowRight)&&(e|=2),(this.keys.c||this.keys.Backspace)&&(e|=16),e}};document.addEventListener("contextmenu",t=>t.preventDefault());document.addEventListener("DOMContentLoaded",async()=>{cn(),ce.set({id:-1,info:{name:"New Level"},json:pt(),base64:""});let t=await Un(),e=je(Oe),n=sn(e),r=new xt(t,n);new Qn({target:document.body,props:{editor:r}})});var xt=class{constructor(e,n){this.physics=e;this.riderData=n;this.undoRedoManager=new mt;this.center={x:0,y:0};this.scaleFactor=.25}start(e){ce.subscribe(a=>{this.levelEntry?.id!==a.id&&(this.undoRedoManager.clear(),this.center={x:0,y:0},xe.set(.25)),this.levelEntry=a,this.updatePhysicsLevel()});let r=Pe[0],i=_e.subscribe(a=>r=a),s=Te,o=ke.subscribe(a=>s=a),c=xe.subscribe(a=>this.scaleFactor=a),d=null,l=null,u=null,g=null,f=null,m=null,h=null,b=null,F=null,B=null,T=0,U=null,L=()=>{m&&(m.pop(),m.length===0&&this.levelEntry.json.lineArrays.pop(),m=null)},k=new bt;window.addEventListener("keydown",a=>{let _=this.levelEntry.json;if(a.key==="1"&&(L(),_e.set("addLineArray")),a.key==="2"&&(L(),_e.set("addCircle")),a.key==="3"&&(L(),_e.set("addCheckpoint")),a.key==="4"&&(L(),_e.set("movePoint")),a.key==="Escape"&&L(),a.key==="Delete"&&b){console.log("delete",b);let Q=b;if(b.type==="lineArrayPoint"){let P=_.lineArrays[b.index][b.subIndex];this.addAction({undo:()=>_.lineArrays[Q.index].splice(Q.subIndex,0,P),redo:()=>_.lineArrays[Q.index].splice(Q.subIndex,1)})}if(b.type==="circle"){let P=_.circles[b.index];this.addAction({undo:()=>_.circles.splice(Q.index,0,P),redo:()=>_.circles.splice(Q.index,1)})}if(b.type==="checkpoint"){let P=_.checkpoints[b.index];this.addAction({undo:()=>_.checkpoints.splice(Q.index,0,P),redo:()=>_.checkpoints.splice(Q.index,1)})}}if(a.key==="z"&&a.ctrlKey&&this.undoRedoManager.undo(),(a.key==="y"&&a.ctrlKey||a.key==="Z"&&a.shiftKey&&a.ctrlKey)&&this.undoRedoManager.redo(),a.key==="+"&&xe.set(this.scaleFactor*1.25),a.key==="-"&&xe.set(this.scaleFactor/1.25),(a.key==="Enter"||a.key===" ")&&this.physics.newGame(),a.key==="m"){let Q=this.physics.level.getCheckpoints().getLength(),P=this.physics.trialsGame.getCurrentCheckpoint();this.physics.trialsGame.setCurrentCheckpoint((P+1)%Q),this.physics.tick(16)}});let I=["mousedown","mouseup","mousemove","mouseenter","mouseleave","mouseout","wheel","click","dblclick"];for(let a of I)window.addEventListener(a,_=>{let Q=_,P=e.getBoundingClientRect(),x=Q.clientX-P.left,V=Q.clientY-P.top;_.target==e&&(_.type==="mousedown"?(g={x,y:V},w(_.button,_.type,{x,y:V})):_.type==="wheel"&&xe.set(this.scaleFactor*Math.pow(1.01,-10*Q.deltaY/Math.abs(Q.deltaY)))),_.type==="mouseup"&&(w(_.button,_.type,{x,y:V}),g=null,w(_.button,_.type,{x,y:V})),_.type==="mousemove"&&w(_.button,_.type,{x,y:V})});let w=(a,_,Q)=>{let P=this.levelEntry.json;if(d=Q,l=D(Q),u=z(Q),a===1&&_==="mousedown")U=Q,T=this.scaleFactor;else if(_==="mousemove"&&U){let x=U.y-Q.y;xe.set(T*Math.pow(1.01,x))}else if(a===1&&_==="mouseup")U=null;else if(a==2&&_==="mousedown")F=this.center,B=Q;else if(_==="mousemove"&&F&&B)this.center={x:F.x-N(Q.x-B.x),y:F.y-N(Q.y-B.y)};else if(a==2&&_==="mouseup")F=null,B=null;else if(a===0&&_==="mousedown"&&r==="addCircle"){let x=z(Q);f=[x.x,x.y,s>0?s:Te];let V=f;this.addAction({undo:()=>{P.circles.pop()},redo:()=>{P.circles.push(V)}})}else if(_=="mousemove"&&f){let x=z(Q),V={x:x.x-f[0],y:x.y-f[1]};f[2]=Math.sqrt(V.x*V.x+V.y*V.y)}else if(a===0&&_=="mouseup"&&f)f=null;else if(a===0&&_==="mousedown"&&r==="addLineArray"){let x=z(Q);if(m==null){m=[[x.x,x.y],[x.x,x.y]];let V=m;this.addAction({undo:()=>{P.lineArrays.pop()},redo:()=>{P.lineArrays.push(V)}})}else{let V=m;this.addAction({undo:()=>{V.pop()},redo:()=>{V.push([x.x,x.y])}})}}else if(_=="mousemove"&&r==="addLineArray"&&m){let x=z(Q);m[m.length-1]=[x.x,x.y]}else if(a===0&&_==="mousedown"&&r==="addCheckpoint"){let x=z(Q),V=[x.x,x.y];this.addAction({undo:()=>{P.checkpoints.pop()},redo:()=>{P.checkpoints.push(V)}})}else if(a===0&&_==="mousedown"&&r==="movePoint"){let x=$t(P,D(Q),200);x.point&&(h=x)}else if(a===0&&_==="mouseup"&&h){let x=h,V=u;this.addAction({undo:()=>A(x,x.point),redo:()=>A(x,V)}),b=h,h=null}else _==="mousemove"&&h&&A(h,u)},A=(a,_)=>{a.type==="lineArrayPoint"?this.levelEntry.json.lineArrays[a.index][a.subIndex]=[_.x,_.y]:a.type==="circle"?(this.levelEntry.json.circles[a.index][0]=_.x,this.levelEntry.json.circles[a.index][1]=_.y):a.type==="checkpoint"&&(this.levelEntry.json.checkpoints[a.index][0]=_.x,this.levelEntry.json.checkpoints[a.index][1]=_.y)},N=a=>a/this.scaleFactor,D=a=>({x:(a.x-e.width/2)/this.scaleFactor+this.center.x,y:(a.y-e.height/2)/this.scaleFactor+this.center.y}),z=a=>J(D(a)),J=a=>s>0?{x:Math.round(a.x/s)*s,y:Math.round(a.y/s)*s}:a,Fe=a=>{let _=j.updateCanvasSize(e);_&&(this.physics.tick(k.encodeGameInput()),Le(_),requestAnimationFrame(Fe))},Le=a=>{let _=this.levelEntry.json;if(a.lineWidth=6,a.lineCap="round",a.fillStyle="white",a.fillRect(0,0,e.width,e.height),a.font="64px 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif",a.save(),a.translate(e.width/2,e.height/2),a.scale(this.scaleFactor,this.scaleFactor),a.translate(-this.center.x,-this.center.y),s>0){a.strokeStyle="#888";let x=z({x:0,y:0}),V=z({x:e.width,y:e.height}),he=x.x-s,ue=x.y-s,G=V.x+s,W=V.y+s;for(let C=he;C<=G;C+=s)j.drawLine(a,C,ue,C,W,"#eee");for(let C=ue;C<=W;C+=s)j.drawLine(a,he,C,G,C,"#eee");j.drawLine(a,0,ue,0,W,"#aaa"),j.drawLine(a,he,0,G,0,"#aaa")}for(let x of _.circles)j.fillOval(a,x[0],x[1],x[2],"red");r=="addCircle"&&f==null&&u&&j.fillOval(a,u.x,u.y,s>0?s:Te,"#FF000033");let Q=on(_.lineArrays);for(let x=0;x<Q.length;x++){let V=Q[x][0],he=Q[x][1];j.drawLine(a,V[0],V[1],he[0],he[1],"blue")}gt.paintRider(a,this.physics.rider),r=="addLineArray"&&m==null&&u&&j.fillOval(a,u.x,u.y,s>0?s/10:10,"#0000FF33");let P=_.checkpoints;for(let x of P)j.drawLine(a,x[0],x[1],x[0],x[1]-100,"#777700"),a.fillText("\u{1F6A9}",x[0],x[1]-100);if(r=="addCheckpoint"&&u&&j.drawLine(a,u.x,u.y,u.x,u.y-100,"#77770033"),r=="movePoint"&&d){let x=$t(_,D(d),200);x.type==="checkpoint"?j.drawLine(a,_.checkpoints[x.index][0],_.checkpoints[x.index][1],_.checkpoints[x.index][0],_.checkpoints[x.index][1]-100,"#000"):x.point&&j.strokeOval(a,x.point.x,x.point.y,s>0?s/5:20,"#000")}a.restore()};requestAnimationFrame(Fe)}addAction(e){this.undoRedoManager.addAction(e),this.updatePhysicsLevel()}new(){ce.set(st())}updatePhysicsLevel(){let e=je(Oe),n=ht(e,this.levelEntry.json);this.physics.setData(n,this.riderData)}};return Nn(ar);})();
//# sourceMappingURL=Editor.js.map
